{
  "hash": "9a62fd391a6bd19e5c8b52d4442ae931",
  "result": {
    "engine": "knitr",
    "markdown": "require(tidyr)\nrequire(dplyr)\nrequire(ggplot2)\nrequire(ggridges)\n\nsource(\"eqcut.r\")\neffICGI<- read.csv(\"ICGI.csv\")\n\neffICGI <- effICGI %>%\n  filter(!is.na(ICGI))%>%\n  filter(!is.na(AUC))\n    effICGI$XDL1C<- factor(effICGI$XDL1)\n\n  \n  \teffICGI$AUC.eqcut <- eqcut(effICGI$AUC,ngroups=4,withhold=list(placebo=(effICGI$AUC==0)) )\n\teffICGI$AUC.int <- Hmisc::cut2(effICGI$AUC,g=4) \n\teffICGI$AUC.intmean <- Hmisc::cut2(effICGI$AUC,g=4,levels.mean = TRUE)                          \n\n observedprobsbuaucbin <- effICGI %>%\n  group_by(AUC.int,AUC.intmean)%>%\n  summarize(N=sum(ICGI,na.rm=TRUE),\n            Nmiss= length(AUC.int[is.na(AUC.int)]),\n            Ntot=n(),\n            prob=N/Ntot,\n            SE= sqrt(prob*(1-prob)/Ntot ))\n\n  effICGI2<- effICGI[effICGI$AUC>0,]\n  effICGI2$XDL1C <- \"(all)\"\n  ggridgedata <- rbind(effICGI,effICGI2)\n  rm(effICGI2)\n\tggridgedata$ypointsdose <-\n\t  ifelse(ggridgedata$XDL1==\"0\"  ,-0.3,\n\t  ifelse(ggridgedata$XDL1==\"600\",-0.45,\n\t  ifelse(ggridgedata$XDL1==\"1200\",-0.6,\n\t  ifelse(ggridgedata$XDL1==\"1800\",-0.75,\n\t  ifelse(ggridgedata$XDL1==\"2400\",-0.9,-1.05)))))\n\n\n \n  effICGIaucstatsbydose<- ggridgedata %>%\n  group_by(XDL1C)%>%\n  summarize(minauc=min(AUC),\n  maxauc=max(AUC),\n  medauc=median(AUC),\n  twentyfifth=quantile(AUC,0.25),\n  seventyfifth=quantile(AUC,0.75),\n  N=sum(ICGI,na.rm=TRUE),\n            Nmiss= length(AUC.int[is.na(AUC.int)]),\n            Ntot=n(),\n            prob=N/Ntot,\n            SE= sqrt(prob*(1-prob)/Ntot ))\n  \n   effICGIaucstatsbydose[effICGIaucstatsbydose$XDL1C==\"(all)\",2:11] <- NA\n  \n  \n  ggridgedata$AUC<- ifelse(ggridgedata$XDL1C==\"0\",NA,\n  ggridgedata$AUC\n  )\n\nggridgedata$XDL1C <- factor(ggridgedata$XDL1C ,\nlevels=c(\"0\", \"600\", \"1200\",\"1800\",\"2400\",\"(all)\"),\nlabels=c(\"Placebo\", \"600 mg\", \"1200 mg\",\"1800 mg\",\"2400 mg\",\"(all)\"))\neffICGIaucstatsbydose$XDL1C <- factor(effICGIaucstatsbydose$XDL1C ,\nlevels=c(\"0\", \"600\", \"1200\",\"1800\",\"2400\",\"(all)\"),\nlabels=c(\"Placebo\", \"600 mg\", \"1200 mg\",\"1800 mg\",\"2400 mg\",\"(all)\"))\n   \n densityplot<- ggplot(ggridgedata, aes(AUC,XDL1C,\ncolour=XDL1C,fill=XDL1C ) )+\n  geom_vline(xintercept=c(9.74,53.37,99.31,343),linetype=2)+\ngeom_point(alpha=0.2,colour=\"gray\")+\n  geom_errorbarh(data=effICGIaucstatsbydose,\n  aes(x=medauc,xmax = twentyfifth, xmin = seventyfifth, height = 0.9))+\n  geom_point(data=effICGIaucstatsbydose,\n  aes(x=medauc) )+\n  geom_density_ridges2(rel_min_height = 0.005,alpha=0.1,scale = 0.9)+\n  geom_density_ridges2(aes(y=\"(all)\"),rel_min_height = 0.005,alpha=0.1,scale = 20)+\n  labs(x=\"AUC µg*h/mL\",y=\"AUC Distributions\",\n  colour=\"Dose (mg)\",fill=\"Dose (mg)\")+\n  scale_x_continuous(breaks=seq(0,400,25))+\n  theme_bw()+\n  theme(legend.position=\"bottom\")+\n  coord_cartesian(xlim=c(-10,375))+\n guides(col = guide_legend(nrow =1),\n fill = guide_legend(nrow =1))\n\nLOGMODEL<- glm(formula = ICGI~ AUC, family = binomial(link = logit), data = effICGI,\n\tna.action = na.exclude, control = list(epsilon = 0.0001, maxit = 50,\n\ttrace = F))\n\tR1<- vcov(LOGMODEL)\n\tcoef(LOGMODEL)\n\nAUC.values <- seq(0,350,1)\nlogitId <- coef(LOGMODEL)[1] + coef(LOGMODEL)[2]*AUC.values\npd <- exp(logitId)/(1 + exp(logitId))\n\npredictions<- data.frame(AUC=AUC.values,pred=pd)\nrm(pd,logitId,AUC.values)\n\n\ntableplot<- ggplot(observedprobsbuaucbin,\naes(\nx=as.double(as.character(AUC.intmean))) )+\n  geom_vline(xintercept=c(9.74,53.37,99.31,343),linetype=2)+\ngeom_text(y=0.25,aes(label=paste(AUC.int,\"\\n\",Ntot,\"\\n\",N,\n\"\\n\",100*round(prob,2),\"%\"\n,sep=\"\")))+\ngeom_text(x=250,y=0.25,\nlabel=paste(\"AUC bins\",\"\\n\",\"Total N\", \"\\n\", \"Responders\",\"\\n\",\"Percentage\",sep=\"\" \n))+\n  scale_x_continuous(breaks=seq(0,400,25))+\n  coord_cartesian(xlim=c(-10,375),ylim=c(0.2,0.3))+\n  theme_bw()+\n   theme(axis.line.x=element_blank(),\n          axis.text.x=element_blank(),\n          axis.ticks.x=element_blank(),\n          axis.title.x=element_blank()\n          )\n\nlogistplot<- ggplot(effICGI, aes(AUC,ICGI) )+\n  #geom_point()+\n  geom_vline(xintercept=c(9.74,53.37,99.31,343),linetype=2)+\n  geom_hline(yintercept=c(0,1))+\n  geom_smooth(method=\"glm\",method.args = list(family = \"binomial\"),color=\"black\",fill=\"gray\")+\n  geom_errorbar(data=observedprobs,aes(\n    x=as.double(as.character(AUC.intmean)),\n    y=prob,ymin=prob+SE,ymax=prob-SE),width=5 )+\n  geom_point(data=observedprobsbuaucbin,aes(\n    x=as.double(as.character(AUC.intmean)),\n    y=prob),size=1.5)+                          \n  geom_point(data=effICGIaucstatsbydose,aes(medauc,y=prob,col=factor(XDL1C)), size=4,alpha=0.5,show.legend=FALSE )+  \n  labs(x=\"AUC µg*h/mL\",y=\"Pr(Response)\")+\n  scale_x_continuous(breaks=seq(0,400,25))+\n  scale_y_continuous(breaks=c(0,0.25,0.50,0.75,1.0))+\n  coord_cartesian(xlim=c(-10,375))+\n  theme_bw()+\n   theme(axis.line.x=element_blank(),\n          axis.text.x=element_blank(),\n          axis.ticks.x=element_blank(),\n          axis.title.x=element_blank(),\n          axis.title.y = element_text(\n          margin = unit(c(0, 8, 0, 0), \"mm\"), angle = 90)\n          )\n\negg::ggarrange(\nlogistplot,tableplot,densityplot,heights=c(1,0.5,1)\n) \n\n\n###\n\ndosepredictionssegements <- dosepredictions %>%\n  group_by(DOSE) %>%\n  dplyr::summarize(\n    minpred=min(value,na.rm = TRUE),\n    maxpred=max(value,na.rm = TRUE),\n    xmin=-5,xmax=-5)\ndosepredictionssegementsx <- dosepredictions %>%\n  group_by(DOSE) %>%\n  dplyr::summarize(\n    minx = min(AUC,na.rm = TRUE),\n    maxx = max(AUC,na.rm = TRUE),\n    ymin=0,ymax=0)",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}