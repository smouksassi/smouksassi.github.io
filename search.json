[
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome to Samer’s Blog",
    "section": "",
    "text": "Welcome!\nThis is the first post in my personal blog. I have been working in the Modeling and Simulation field for 20 years and I started this blog to share my experience and how general solutions were developed to tackle specific and more general problems. I will keep this first post short and leave you with one of the dose exposure figures (using dummy data) that I developed for an FDA submission 15 years ago. Through out the years these visuals has evolved and are now part of my ggquickeda package that will be covered in future posts.\n\nThis visual include several components:\n\ndistribution of exposures (AUC) by dose level\nfor each distribution we show the percentage of it falling within a specific quantile of AUC\nin the middle we have a table detailing for Placebo and each Quartile: AUC bins, Total N of patients, N of Responders, and the observed Percentage of response\nin the upper panel a logistic fit and its 95%CI of the probability of clinical response versus AUC is shown.\nThe predicted response by dose level at the 10th, 25th, median,75th and 90th of exposure is shown and projected on the logistic curve\nThe predicted response is also projected on Y axis for head to head comparison across doses and to appreciate the saturation at the highest dose levels/exposures"
  },
  {
    "objectID": "posts/erplots/index.html",
    "href": "posts/erplots/index.html",
    "title": "Visualizing Dose Exposure Response",
    "section": "",
    "text": "In this post I will provide the code and thinking process behind the figure shared in my first blog post. We will start with a simpler version where we show the Endpoint versus exposures, which in this case are areas under the drug concentrations curves (AUC) on top. And at the bottom, the individual AUCs by dose level with a different symbol by responder status: responder (as triangles) and not responder (as circles).\n\n\nCode\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(ggquickeda)\nlibrary(patchwork)\nlibrary(ggridges)\nlibrary(ggrepel)\n\nICGI&lt;- read.csv(\"ICGI.csv\")\nICGI$responder &lt;- ifelse(ICGI$ICGI==1,\"responder\",\n                         \"not responder\")\nICGI$DOSE &lt;- as.factor(ICGI$DOSE)\nICGI$DOSE &lt;- factor(ICGI$DOSE,\n                    levels=c(\"0\", \"600\", \"1200\",\"1800\",\"2400\"),\n                    labels=c(\"Placebo\", \"600 mg\", \"1200 mg\",\"1800 mg\",\"2400 mg\"))\np1 &lt;-  ggplot(ICGI, aes(AUC, ICGI)) +\n  geom_point(\n    aes(shape=responder),\n    position = position_jitter(height = 0.08),\n    size = 3,\n    alpha = 0.2\n  ) +\n  geom_smooth(\n    method = \"glm\",\n    method.args = list(family = \"binomial\"),\n    se = TRUE\n  ) +\n  theme_bw(base_size = 16) +\n  guides(shape=guide_legend(reverse=TRUE))+\n  labs(x=\"AUC (µg*h/mL)\",y=\"Probability of Endpoint\", shape = \"\")\n\np2 &lt;-\n  ggplot(ICGI, aes(AUC, DOSE)) +\n  geom_point(\n    data = ICGI[ICGI$responder == \"responder\", ],\n    position = position_nudge(y = -0.25),\n    size = 3,\n    alpha = 0.2,\n    shape = \"circle\"\n  ) +\n  geom_point(\n    data = ICGI[ICGI$responder != \"responder\", ],\n    position = position_nudge(y = 0.25),\n    size = 3,\n    alpha = 0.2,\n    shape = \"triangle\"\n  ) +\n  theme_bw(base_size = 16) +\n  labs(y = \"Dose\")\n(p1+\ntheme(legend.position = \"inside\",\n      legend.position.inside = c(0.8,0.55),\n      legend.background = element_rect(fill = \"transparent\",\n                                       colour = \"black\"),\n      legend.title = element_blank(),\n  axis.text.x.bottom = element_blank(),\n      axis.title.x.bottom = element_blank())+\n  scale_y_continuous(breaks= seq(0,1,0.2),\n                     labels = scales::percent_format())\n  )/(p2+\n  scale_x_continuous(breaks= seq(0,400,50))+\n  labs(x=\"AUC (µg*h/mL)\",shape =\"\"))\n\n\n\n\n\n\n\n\n\nWith this visual representation several questions remain without an answer:\n\nWhat is the probability of response by dose level?\nWhat is the probability of response by tertiles or quartiles of exposures ? and how about the Placebo (exposure = 0) response?\n\nWe will answer these questions incrementally. First we reshape the data into long format to accomodate the possibility of multiple endpoints and multiple exposure metrics. Second we compute the quartiles of exposures by exposure metric and endpoint, keeping the Placebo separate. Then we add the variable exptile that will assign to each exposure one of the following values: “Placebo”, “Q1”, “Q2”, “Q3”, “Q4”. We also compute the exposure limits that can be used in the graph to show the limits of each quartile.\n\n\nCode\nexposure_metric_plac_value &lt;- 0\n# compute quantiles and assign each exposure to its corresponding exptile\nICGIlong &lt;- ICGI %&gt;% \n  gather(Endpoint,response,ICGI)    %&gt;% # can handle multiple endpoints at the same time \n  gather(expname,expvalue,AUC,CMAX) %&gt;% # can handle multiple exposures at the same time\n  group_by(Endpoint,expname) %&gt;% \n  mutate( Q25     = quantile(expvalue[!expvalue %in% c(exposure_metric_plac_value)], 0.25, na.rm = TRUE), \n          Q50     = quantile(expvalue[!expvalue %in% c(exposure_metric_plac_value)], 0.50, na.rm = TRUE), \n          Q75     = quantile(expvalue[!expvalue %in% c(exposure_metric_plac_value)], 0.75, na.rm = TRUE), \n          exptile = case_when(expvalue == exposure_metric_plac_value ~ \"Placebo\",\n                            expvalue &gt; exposure_metric_plac_value & expvalue &lt;= Q25\n                                                               ~ \"Q1\",\n                            expvalue &gt;  Q25 & expvalue &lt;=  Q50 ~ \"Q2\",\n                            expvalue &gt;  Q50 & expvalue &lt;= Q75  ~ \"Q3\",\n                            expvalue &gt;  Q75                    ~ \"Q4\"))\n\nexposurelimits &lt;- ICGIlong %&gt;% \n  group_by(expname, Endpoint)%&gt;% \n  reframe(intercept = quantile(expvalue[!expvalue %in%\n                         c( exposure_metric_plac_value)], \n                         c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE),\n              quant =    c(0,0.25, 0.5, 0.75, 1))\n\n\nWe prepare the distributions plot beneath the probability of response curve by using ggridges, constructing a numrical value for where to plot the distributions and by excluding the Placebo from the distributions plot. The distributions are shown as densities scaled to 1 with quantiles lines at 10th, 25th 50th, 75th and 90th percentiles.\n\n\nCode\n#these values will become an argument in the ER function\n  dist_position_scaler = 0.2\n  dist_offset = 0\n  dist_scale = 0.9\nICGIlong$keynumeric &lt;- -dist_position_scaler * as.numeric(\n    forcats::fct_rev(as.factor(dplyr::pull(ICGIlong[,\"DOSE\"])))) + dist_offset\n  \np1 &lt;- ggplot(ICGIlong, aes(expvalue,response) )+\n  geom_point(aes(col=DOSE))+\n  geom_hline(yintercept=c(0,1),col=\"darkgray\")+\n  geom_vline(data=exposurelimits,aes(xintercept = intercept),col=\"lightgray\",\n             linetype=\"dashed\")+\n   geom_text(data=exposurelimits,\n             aes(x = intercept,y=Inf,label=round(intercept,1)),col=\"lightgray\",\n             vjust=1)+\n  geom_smooth(method=\"glm\",\n              method.args = list(family = \"binomial\"),\n              color=\"black\",aes(fill=\"logistic fit (95%CI)\"))+\n  geom_density_ridges(data=ICGIlong %&gt;% \n                        filter(DOSE!=\"Placebo\"),\n                      aes(expvalue,y=keynumeric,\n                          group=DOSE,col=DOSE,\n                          height = after_stat(ndensity)),\n                      rel_min_height = 0.005,alpha=0.1,scale = dist_scale,\n                      quantile_lines = TRUE, quantiles = c(0.1,0.25, 0.5, 0.75,0.9))+\n   geom_point(data=ICGIlong%&gt;% \n                        filter(DOSE!=\"Placebo\"), aes(expvalue,y=keynumeric-0.025,col=DOSE),alpha = 0.2)+\n  facet_grid(~expname,scales=\"free_x\")+\n  ggthemes::scale_color_tableau()+\n  scale_fill_manual(values=\"gray\")+\n  labs(fill=\"\")+\n  theme_bw()+\n  theme(legend.position = \"top\")+\n  guides(fill  = guide_legend(order = 1),\n         color = guide_legend(order = 2, nrow=2, reverse = TRUE))\n\n\nNext we compute the probabilities of response by exposures quartiles and by dose levels and add it to the plot using geom_pointrange\n\n\nCode\nsummary_df &lt;- function (x, y, probs = c(0.1, 0.25, 0.75, 0.9), continuous = FALSE) \n{\n    tibble::tibble(minexp = min(x),\n                   maxexp = max(x),\n                   medexp = median(x), \n        meanexp = mean(x),\n        N = ifelse(!continuous, sum(y, na.rm = TRUE), \n            n()),\n        Nmiss = length(x[is.na(x)]),\n        Ntot = dplyr::n(), \n        meanresp = ifelse(!continuous, N/Ntot, mean(y, na.rm = TRUE)), \n        prob = meanresp,\n        SE = ifelse(!continuous,\n            sqrt(meanresp * (1 - meanresp)/Ntot),\n            sd(y, na.rm = TRUE)/sqrt(Ntot)), \n        values = quantile(x, probs, na.rm = TRUE), quant = probs)\n}\n\nICGIlong.summaries.dose &lt;- ICGIlong %&gt;% \n    group_by(Endpoint,expname,DOSE,keynumeric) %&gt;% \n    reframe(summary_df(expvalue,response))%&gt;% \n  pivot_wider(names_from = quant, \n  values_from = values, names_glue = \"quant_{100*quant}\")\n  \n  ICGIlong.summaries.exposure &lt;- ICGIlong %&gt;% \n    ungroup() %&gt;% \n    group_by(Endpoint,expname,exptile) %&gt;% \n    reframe(summary_df(expvalue,response))%&gt;% \n  pivot_wider(names_from = quant, \n  values_from = values, names_glue = \"quant_{100*quant}\")\n  \n\np2 &lt;- p1 +\n   geom_linerange(data=ICGIlong.summaries.dose,\n                  aes(x=medexp,xmin = quant_10,xmax = quant_90,\n                      y=keynumeric+0.025,col=DOSE),\n                  linewidth = 2, alpha = 0.4)+\n   geom_linerange(data=ICGIlong.summaries.dose,\n                  aes(x=medexp,xmin = quant_25,xmax = quant_75,\n                      y=keynumeric+0.025,col=DOSE),\n                  linewidth = 2.5, alpha = 0.4)+\n   geom_point(data=ICGIlong.summaries.dose,\n                  aes(x=medexp,\n                      y=keynumeric+0.025,col=DOSE),\n                  size = 3, alpha = 0.2)+\n  geom_pointrange(data=ICGIlong.summaries.dose,\n                  alpha=0.4,\n                  aes(x= medexp, y = meanresp,\n                      ymin =meanresp-1.96*SE,\n                      ymax =meanresp+1.96*SE,\n                      col = DOSE,\n                      shape =\"by dose\")\n                  )+\n  geom_pointrange(data=ICGIlong.summaries.exposure,\n                  alpha=0.4,\n                  aes(x= medexp, y = meanresp,\n                      ymin =meanresp-1.96*SE,\n                      ymax =meanresp+1.96*SE,\n                      shape =\"by quartile\")\n                  )+\n  labs(shape=\"observed\\nprobability\")+\n  guides(shape = guide_legend(order=3,nrow=2,reverse = TRUE))\n\n\nFinally we want to annotate the plot by displaying for each exptile the bin limits, the total N of subjects, the N of responders the probability of response.\n\n\nCode\nICGIlong.summaries.exposure &lt;- ICGIlong.summaries.exposure %&gt;% \n  mutate(label= ifelse(exptile!=\"Placebo\",\n                       paste0(exptile,\"\\n\",\"[\",round(minexp,0),\"-\",round(maxexp,0),\"]\",\n                             \"\\n\",N,\"\\n\",Ntot,\"\\n\",\n                              round(100*meanresp,1)),\n                       paste0(exptile,\"\\n\",\"\",\n                             \"\\n\",N,\"\\n\",Ntot,\"\\n\",\n                              round(100*meanresp,1))\n                       \n                       ),\n         \n         \n         ytext= 0.25)\np2txt &lt;- p2 +\n  geom_text(data=ICGIlong.summaries.exposure,size = 1.5,\n            aes(x=meanexp ,label=label,y=ytext),inherit.aes = FALSE)+\n  facet_wrap(~expname,ncol=2,scales = \"free_x\")\n  \np2txt +\n  scale_y_continuous( \nbreaks = c(sort(unique(ICGIlong$keynumeric)), \nc(0, 0.25,  0.5,0.75, 1)),\nlabels = c(levels(ICGIlong$DOSE), \nc(\"0\", \"25%\", \"50%\",\"75%\",\"100%\")),\n             expand = expansion(mult = c(0.01, 0.01), \n                                add = c(0, 0))\n\n)+\nlabs(x=\"Exposure Values\",\n     y=\"Probability of Endpoint\")\n\n\n\n\n\n\n\n\n\nIn the ggquickeda package the ggresponseexpdist function automate a lot of these operations to be able to generate these advanced plots using concise syntax.\n\n\nCode\nICGIERDATA &lt;- ICGI\nICGIERDATA$Endpoint &lt;- \"ICGI\"\nICGIERDATA$response &lt;- ICGIERDATA$ICGI \n\nggresponseexpdist(data = ICGIERDATA,\nmodel_type = \"logistic\",\nexposure_metrics = c(\"AUC\"),\nexposure_metric_split = \"quartile\",\nN_byexptile_ypos = \"with means\",\nmean_obs_bydose = TRUE,\nmean_obs_bydose_plac = FALSE,\nN_bydose_ypos = \"none\",\nmean_obs_bydose_text_size = 0,\nN_text_size = 3,\nexposure_distribution_percent = \"%\")"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Samer MouksassiBio & Contact",
    "section": "",
    "text": "Hi, I have been working in the Model-Informed Drug Development field for more than 20 years. I have done projects for small start-ups, small, mid and large Pharmaceutical companies as well as Global Health key players like the Gates Foundation. My core services are focused on pharmacometrics analyses to support your drug development programs. I have contributed to 100+ projects, serving 40+ different clients ranging from pre-clinical, translational qsp and regulatory Population PK/PD filings using the totality of data including large phase III registration trials as well as real world data. Under my belt, I have contributed to 10+ regulatory approvals for FDA, EMA, PMDA, China and Health Canada across various therapeutic areas namely in rare diseases and pediatrics. Feel free to send me an email to start our discussion on how to start collaborating.\n\nTeachingExperienceEducationSelected Publications\n\n\nMy current and previous roles involved leading, mentoring and building pharmacometrics teams across the globe first with Pharsight in Montreal Canada and later with Certara in Cairo (Egypt) and Cape Town (South Africa). I have a passion for teaching and for building tools that empower non-coders to communicate efficiently. Some of my R packages include (coveffectsplot, ggquickeda and tidyvpc).\n\n\nFull Professional Researcher | Savic Lab\nUCSF, San Francisco | 2025 - Present\nSenior Director Pharmacometrics | Strategic Services Certara\nCairo/Cape Town | 2019 - 2024\nDirector Pharmacometrics | Strategic Services\nCertara, Montreal | 2014 - 2019\nAssociate Director Pharmacometrics | Consulting Services\nPharsight, Montreal | 2009 - 2014\nSenior Associate Scientist | Reporting and Analysis Services\nPharsight, Montreal | 2007 - 2009\n\n\nUniversity of Montreal, Montreal | Quebec, Canada\nPhD Pharmaceutical Sciences (Pharmacometrics) | 2006 - 2012\nUniversity of Montreal, Montreal | Quebec, Canada\nMSc Pharmaceutical Sciences (Pharmacometrics) | 2004 - 2006\nUniversity of Saint Joseph | Beirut Lebanon\nMSc Biostatistics and Epidemiology | 2002 - 2004\nLebanese University | Beirut, Lebanon\nPharm D | 1997 - 2003\n\n\n\nPharmacokinetic and pharmacodynamic modelling of continuous erythropoiesis receptor activator in children: A comprehensive analysis and real-world data validation. Samer Mouksassi, Franz Schaefer, Bradley A. Warady, Claus P. Schmitt, Sylvie Meyer Reigner, Milena Studer, Pascal Chanu, Nicolas Frey. Br J Clin Pharmacol. 2025;1–12. doi:10.1002/bcp.70165\nPharmacometric Analysis to Describe Pharmacokinetics and Exposure-Efficacy Response of Ivermectin in Adolescents Infected with Trichuris trichiura. Ajayi DT, Orherhe OM, Pillai GC, Mouksassi S, Steffens B, Bräm D, Sprecher V, Hofmann D, Buettcher M, Coulibaly JT, Ali SM, Keiser J, Pfister M. P. J Clin Pharmacol. 2024 Nov 6. doi: 10.1002/jcph.6158.\nPostmarketing Assessment of Antibody-Drug Conjugates: Proof-of-Concept Using Model-Based Meta-Analysis and a Clinical Utility Index Approach. Asiimwe IG, Chtiba N, Mouksassi S, Pillai GC, Peter RM, Yuen E, Pilla Reddy V. CPT Pharmacometrics Syst Pharmacol. 2025 Mar 4. doi: 10.1002/psp4.70013.\nAdvancing pharmacometrics in Africa-Transition from capacity development toward job creation. Pillai GC, Mouksassi S, Asiimwe IG, Rayner CR, Kern S, Sinxadi P, Denti P, Decloedt E, Waitt C, Ogutu BR, de Greef R. CPT Pharmacometrics Syst Pharmacol. 2025 Mar;14(3):407-419.\nQuantifying natural amyloid plaque accumulation in the continuum of Alzheimer’s disease using ADNI. Elhefnawy ME, Patson N, Mouksassi S, Pillai G, Shcherbinin S, Chigutsa E, Gueorguieva I. J Pharmacokinet Pharmacodyn. 2025 Jan 25;52(1):15.\nEEDBI Consortium.Anthropometry relationship with duodenal histologic features of children with environmental enteric dysfunction: a multicenter cross-sectional study. Jamil Z, VanBuskirk K, Mweetwa M, Mouksassi S, Smith G, Ahmed T, Chandwe K, Denno DM, Fahim SM, Kelly P, Mahfuz M, Mallawaarachchi I, Marie C, Moore SR, Petri WA Jr, Ali SA. Am J Clin Nutr. 2024 Sep;120 Suppl 1:S65-S72.\nMultiplexed immunohistochemical evaluation of small bowel inflammatory and epithelial parameters in environmental enteric dysfunction. VanBuskirk K, Mweetwa M, Kolterman T, Raghavan S, Ahmed T, Ali SA, Begum SKN, Besa E, Denno DM, Jamil Z,/&gt; Kelly P, Mahfuz M, Moore SR, Mouksassi S, Petri WA Jr, Tarr PI, Sullivan PB, Moskaluk CA; EEDBI Consortium. . Am J Clin Nutr. 2024 Sep;120 Suppl 1:S31-S40.\nHistopathology underlying environmental enteric dysfunction in a cohort study of undernourished children in Bangladesh, Pakistan, and Zambia compared with United States children. Kelly P, VanBuskirk K, Coomes D, Mouksassi S, Smith G, Jamil Z, Hossain MS, Syed S, Marie C, Tarr PI, Sullivan PB, Petri WA Jr, Denno DM, Ahmed T, Mahfuz M, Ali SA, Moore SR, Ndao IM, Tearney GJ, Ömer H Yilmaz, Raghavan SS, Moskaluk CA, Liu TC; EEDBI Consortium. Am J Clin Nutr. 2024 Sep;120 Suppl 1:S15-S30.\nUnderstanding Drug Exposure and Trichuris trichiura Cure rates: A Pharmacometric Approach for Albendazole‑Ivermectin Co‑medication in Tanzania and Côte d’Ivoire. Pillay‑Fuentes Lorente V, Nwogu‑Attah J, Steffens B, Bräm D, Sprecher V, Hofmann D, Buettcher M, Pillai G, Mouksassi S, Coulibaly J, Pfister M, Keiser J Drugs R D. 2024 Jun;24(2):331-340./&gt;\nMachine-Learning Assisted Screening of Correlated Covariates: Application to Clinical Data of Desipramine./&gt; Asiimwe IG, S’fiso Ndzamba B, Mouksassi S, Pillai GC, Lombard A, Lang J. AAPS J. 2024 May 30;26(4):63.\nTotality of evidence of the effectiveness of repurposed therapies for COVID-19: Can we use real-world studies alongside randomized controlled trials? Mandema J, Montgomery H, Dron L, Fu S, Russek-Cohen E, Bromley C, Mouksassi S, Lalonde A, Springford A, Tsai L, Ambery P, McNair D, Qizilbash N, Pocock S, Zariffa N. Clin Transl Sci. 2023 Oct;16(10):1842-1855.\n\n\n\n\nWhen not, analyzing data, building exciting data displays and innovating with new trial designs, I enjoy spending time in nature, working out and reading."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Samer Mouksassi Blog Posts",
    "section": "",
    "text": "Visualizing Time to Event Response\n\n\n\nnews\n\nvisualization\n\n\n\n\n\n\n\n\n\nAug 25, 2025\n\n\nSamer Mouksassi\n\n\n\n\n\n\n\n\n\n\n\n\nVisualizing Dose Exposure Response\n\n\n\nnews\n\nvisualization\n\n\n\n\n\n\n\n\n\nAug 18, 2025\n\n\nSamer Mouksassi\n\n\n\n\n\n\n\n\n\n\n\n\nWelcome to Samer’s Blog\n\n\n\nnews\n\n\n\n\n\n\n\n\n\nAug 15, 2025\n\n\nSamer Mouksassi\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/KMplots/index.html",
    "href": "posts/KMplots/index.html",
    "title": "Visualizing Time to Event Response",
    "section": "",
    "text": "In this post, I will continue with the exposure response theme. The previous blog post focused on Binary response outcomes. In today’s post I will illustrate how to explore and communicate time to event outcomes. First we start using a specialized geom from my ggquickeda package: geom_km(). Since this is a native ggplot2 geom it supports, aesthetics, faceting and margins, themings and anything else you expect from a ggplot2 object. Later on I cover the usage of the specialized ggkmrisktable function that support adding number at risk tables and more.\n\n\nCode\nlibrary(ggplot2)\nlibrary(patchwork)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(ggquickeda)\nlibrary(scales)\n\n options(ggplot2.discrete.colour =\n           list(c( \"#4682AC\",\"#FDBB2F\",\"#EE3124\" ,\"#336343\",\"#7059a6\", \"#803333\")))\n  options(ggplot2.discrete.fill =\n           list(c( \"#4682AC\",\"#FDBB2F\",\"#EE3124\" ,\"#336343\",\"#7059a6\", \"#803333\"))) \n  \nlung_long &lt;-  survival::lung |&gt;\n mutate(status = ifelse(status==1,0,1)) |&gt;\n gather(Endpoint,DV,status) |&gt;\n filter(!is.na(ph.karno),!is.na(pat.karno),!is.na(ph.ecog))|&gt;\n mutate(ph.ecog = ifelse(ph.ecog&gt;1,\"&gt;1\",\"1\"))\n\nggplot(lung_long, aes(\n                 time = time,\n               status = DV,\n               color  = ph.ecog,\n               linetype = ph.ecog,\n               fill = ph.ecog)) + \n  geom_kmband()+\n  geom_km() +\n  facet_grid(~ph.ecog,margin=\"ph.ecog\",\n             labeller = label_both)+\n  theme_bw(base_size = 16) +\n  labs(x=\"time of follow up\",y=\"Survival\")\n\n\n\n\n\n\n\n\n\nThis is a nice Kaplan-Meir plot that shows the K-M estimate by ecog status and both overlaid in the facet margin (all) panel. To include the effects of continuous variables, we will need to “bin” it. I will use age as a example predictor binning it by tertiles. Some nice features are outlined below:\n\nThis is a ggplot object and we can facet by any variable available in the dataset. Furthermore, I will illustrate the usage of the nice facet_nested from the ggh4x package to group facet strips that belong to the same level.\nThe plot is done in two ways using exptile as color and faceting variable which result in a facet margin (all) having the pooled estimate (all tertiles combined). Then, using exptile as color and faceting by an exact copy of it that we call exptile2. This tricks ggplot2 margins to overlay the three tertiles curves in the (all) panels.\n\n\n\nCode\nexposure_metric_plac_value &lt;- 0\n\nlung_long_metrics &lt;- lung_long %&gt;% \n  gather(expname,expvalue,age) |&gt;\n  group_by(Endpoint,expname) |&gt;\n  mutate( Q33 = quantile(expvalue[!expvalue %in% c(exposure_metric_plac_value)], 1/3, na.rm = TRUE), \n          Q66 = quantile(expvalue[!expvalue %in% c(exposure_metric_plac_value)], 2/3, na.rm = TRUE),\n          exptile = case_when(\n            expvalue == exposure_metric_plac_value ~ \"zero\", \n            expvalue &gt; exposure_metric_plac_value & expvalue &lt;= Q33 ~ \"T1\",\n            expvalue &gt; Q33 & expvalue &lt;= Q66 ~  \"T2\",\n            expvalue &gt; Q66 ~ \"T3\")\n  )\nlibrary(ggh4x)\nggplot(lung_long_metrics, aes(\n                 time = time,\n               status = DV,\n               color  = exptile,\n               linetype = ph.ecog,\n               fill = exptile)) + \n  geom_km() +\n  facet_nested( ph.ecog~ expname+ exptile,\n               labeller = label_both,margin = \"exptile\")+\n  theme_bw(base_size = 12) +\n  labs(x=\"time of follow up\",y=\"Survival\")\n\n\n\n\n\n\n\n\n\nCode\nlung_long_metrics$exptile2 &lt;- lung_long_metrics$exptile\n\nggplot(lung_long_metrics, aes(\n               time = time,\n               status = DV,\n               color  = exptile,\n               linetype = ph.ecog,\n               fill = exptile)) + \n  geom_km() +\n  facet_nested( ph.ecog ~ expname + exptile2,\n               labeller = label_both, margins = \"exptile2\")+\n  theme_bw(base_size = 12) +\n  labs(x=\"time of follow up\",y=\"Survival\")\n\n\n\n\n\n\n\n\n\nIt is common for these type of plots to present a transformation of the default which is the probability of not having the event . For example, changing it to cumulative hazard, or to event probability. It is also desirable to have a number at risk table underneath the plot. ggkmrisktable was written to facilitate and automate these tasks with several flexible options. First, we try to reproduce the last two plot. Notice how exptile2 is available automatically to enable different margins.\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  linetype = \"ph.ecog\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  nrisk_table_plot = TRUE, km_band = FALSE,\n  nrisk_table_variables = c(\"n.risk\")\n)+\n  facet_grid(ph.ecog~exptile,margin = \"exptile\")\n\n\n\n\n\n\n\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  linetype = \"ph.ecog\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  nrisk_table_plot = TRUE, km_band = FALSE,\n  nrisk_table_variables = c(\"n.risk\")\n)+\n  facet_grid(ph.ecog~exptile2,margin = \"exptile2\")\n\n\n\n\n\n\n\n\n\nThe plot above is busy and need to be simplified. Next, I show how to transform the event and I facet by ecog status.\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  linetype = \"ph.ecog\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  show_exptile_values = FALSE,\n  color_fill = \"exptile\",\n  xlab = \"time of follow up\",\n  ylab = \"Survival\",\n  nrisk_table_plot = TRUE,\n  nrisk_table_variables = c(\"n.risk\",\"n.censor\"),\n  nrisk_position_scaler = 0.2,\n  nrisk_position_dodge = 0.2,\n  nrisk_offset = 0,\n  km_trans = c(\"event\"),\n  km_ticks = FALSE, km_band = FALSE,\n  km_median_table_order = c(\"default\"),\n  facet_formula = ~ph.ecog)+\n  facet_nested( expname~ph.ecog,labeller = label_both)+\n  labs(x=\"time of follow up\",y=\"Survival\")\n\n\n\n\n\n\n\n\n\nThe use of additional options like showing the tertiles cutoffs, the median survival, controlling the order and the interval at which numbers at risk appear is shown next.\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  show_exptile_values = TRUE,\n  show_exptile_values_order = \"default\",\n  km_median =\"table\",\n  km_median_table_pos =\"right\",\n  km_median_table_order = \"default\",\n  color_fill = \"exptile\",\n  xlab = \"time of follow up\",\n  ylab = \"Survival\",\n  nrisk_table_plot = TRUE,\n  nrisk_table_variables = c(\"n.risk\",\"n.censor\"),\n  nrisk_position_scaler = 0.2,\n  nrisk_position_dodge = - 0.2,\n  nrisk_filterout0 = TRUE,\n  nrisk_table_breaktimeby = 50,\n  nrisk_offset = 0,\n  km_ticks = FALSE, km_band = TRUE,\n  km_trans = \"event\",\n  facet_formula = ~expname)\n\n\n\n\n\n\n\n\n\nWhile the function supports computing and printing p-values, I strongly, recommend that one run the statistical tests outside of the function. Make sure to document what test was done, on which data. Then we included the appropriate information using regular text/lable ggplot2 layer. An example, showing how to do an LRT on a cox fit is included.\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  color_fill = \"exptile\",\n  linetype = \"exptile\", groupvar1 = \"none\",\n  groupvar2 = \"none\",groupvar3 = \"none\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  nrisk_table_plot = FALSE,\n  km_ticks = FALSE, km_band = FALSE,\n  km_trans = \"event\",\n  km_logrank_pvalue = TRUE,\n  facet_formula = expname ~ Endpoint )\n\n\n\n\n\n\n\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  color_fill = \"ph.ecog\",\n  linetype = \"none\", groupvar1 = \"none\",\n  groupvar2 = \"none\",groupvar3 = \"none\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  nrisk_table_plot = FALSE,\n  km_ticks = FALSE, km_band = FALSE,\n  km_trans = \"event\",\n  km_logrank_pvalue = TRUE,\n  km_logrank_pvalue_cutoff = 0.001,\n  facet_formula = ~Endpoint)\n\n\n\n\n\n\n\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  color_fill = \"exptile\",\n  linetype = \"exptile\", groupvar1 = \"ph.ecog\",\n  groupvar2 = \"none\",groupvar3 = \"none\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  nrisk_table_plot = FALSE,\n  km_ticks = FALSE, km_band = FALSE,\n  km_trans = \"event\",\n  km_logrank_pvalue = TRUE,\n  facet_formula = ~ph.ecog)\n\n\n\n\n\n\n\n\n\nOne would expect that the p-values shown in each panel are specific for the subset of panel data comparing the curves. While the case of single split, are clear, things get out of control fast when we have multiple splits/predictors and then deciding on what particular test we really want. Is it overall on all data ar within a specific strata/subset?\n\n\nCode\nlibrary(survival)\n#| message: false\n#| warning: false\n#| paged-print: true\n\n# overall \nsurvdiffexptile &lt;- survdiff(Surv(time, DV) ~ exptile,\n         data=lung_long_metrics)\npvalueexptile &lt;- pchisq(survdiffexptile$chisq, length(survdiffexptile$n)-1, lower.tail = FALSE)\npvalueexptile\n\n\n[1] 0.2132509\n\n\nCode\nsurvdiffph.ecog &lt;- survdiff(Surv(time, DV) ~ ph.ecog,\n         data=lung_long_metrics)\npvalueph.ecog &lt;- pchisq(survdiffph.ecog$chisq, length(survdiffph.ecog$n)-1, lower.tail = FALSE)\n\n\nsurvdiffexptileecoggt1 &lt;- survdiff(Surv(time, DV) ~ exptile,\n         data=lung_long_metrics %&gt;% \n           filter(ph.ecog!=\"1\"))\npvalueexptileecoggt1 &lt;- pchisq(survdiffexptileecoggt1$chisq, length(survdiffexptileecoggt1$n)-1, lower.tail = FALSE)\npvalueexptileecoggt1\n\n\n[1] 0.5051531\n\n\nCode\nsurvdiffexptileecogeq1 &lt;- survdiff(Surv(time, DV) ~ exptile,\n         data=lung_long_metrics %&gt;% \n           filter(ph.ecog==\"1\"))\npvalueexptileecogeq1 &lt;- pchisq(survdiffexptileecogeq1$chisq, length(survdiffexptileecogeq1$n)-1, lower.tail = FALSE)\npvalueexptileecogeq1\n\n\n[1] 0.5783551\n\n\nA global test across multiple variables that enter the survival equation, with or without interaction can be needed. For these, Idefinitely recommend to avoid using the automatic built-in p-values. The ggkmrisktable has groupvar1, groupvar2, and groupvar3 variables to give the user more control on how to “group” to test p-values but possibilities remain limited as compared to controlling the test with user-written code.\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  color_fill = \"exptile\",\n  linetype = \"ph.ecog\", groupvar1 = \"none\",\n  groupvar2 = \"none\",groupvar3 = \"none\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  nrisk_table_plot = FALSE,\n  km_ticks = FALSE, km_band = FALSE,\n  km_trans = \"event\",\n  km_logrank_pvalue = TRUE,\n  facet_formula = ~Endpoint)\n\n\n\n\n\n\n\n\n\nCode\nsurvdiffph.ecogexptile &lt;- survdiff(Surv(time, DV) ~ ph.ecog+exptile, data=lung_long_metrics)\npvalueph.ecogexptile &lt;- pchisq(survdiffph.ecogexptile$chisq, length(survdiffph.ecogexptile$n)-1, lower.tail = FALSE)\npvalueph.ecogexptile\n\n\n[1] 0.002126178\n\n\nCode\nrmsmodel1 &lt;- coxph(Surv(time, DV) ~ 1, data       = lung_long_metrics)\nrmsmodel2 &lt;- coxph(Surv(time, DV) ~ ph.ecog*exptile, data = lung_long_metrics)\n#anova(rmsmodel1,rmsmodel2)\n\nandata &lt;- anova(rmsmodel1,rmsmodel2)\n\n\npvalueinformation = data.frame(p=andata[2,4],\n                               Endpoint=\"status\",\n                               Model=\"Surv(time, DV) ~ ph.ecog*age(tertiles)\",\n                               test=\"LRT\")\n\n\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  color_fill = \"exptile\",\n  linetype = \"ph.ecog\", groupvar1 = \"none\",\n  groupvar2 = \"none\",groupvar3 = \"none\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  nrisk_table_plot = FALSE,\n  km_ticks = FALSE, km_band = FALSE,\n  km_trans = \"event\",\n  km_logrank_pvalue = FALSE,\n  facet_formula = ~Endpoint)+\n  geom_text(data=pvalueinformation,\n            aes(x=1000,y=0.2,label=paste0(\"Model: \",Model,\"\\n\",\n                                         test,\" test vs null model: \", scales::pvalue( p,add_p = TRUE,accuracy = 0.0001))),inherit.aes = FALSE,\n            hjust=1)\n\n\n\n\n\n\n\n\n\nCode\nggkmrisktable(\n  data = lung_long,\n  time = \"time\",\n  status = \"DV\",\n  endpoint = \"Endpoint\",\n  color_fill = \"exptile\",\n  linetype = \"ph.ecog\", groupvar1 = \"none\",\n  groupvar2 = \"none\",groupvar3 = \"none\",\n  exposure_metrics = c(\"age\"),\n  exposure_metric_split = c(\"tertile\"),\n  nrisk_table_plot = TRUE,nrisk_table_variables = c(\"n.risk\"),\n  km_ticks = FALSE, km_band = FALSE,\n  km_trans = \"event\",\n  km_logrank_pvalue = FALSE,\n  facet_formula = ~Endpoint)+\n  facet_grid(expname~ph.ecog)+\n  geom_text(data=pvalueinformation,\n            aes(x=1000,y=0.2,label=paste0(\"Model: \",Model,\"\\n\",\n                                         test,\" test vs null model: \", scales::pvalue( p,add_p = TRUE,accuracy = 0.0001))),inherit.aes = FALSE,\n            hjust=1)\n\n\n\n\n\n\n\n\n\nIn this post, I introduced some of the features available in ggkmrisktable. Since this is a regular ggplot2 plot the possibilities are limitless.\nIf you have any questions feel free to contact me on github."
  }
]